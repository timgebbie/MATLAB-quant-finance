%% Test Script #4 Simulated Annealing with large Synthetic Data 
%
% Name: SECTORS_TEST_ANNEALING_001.M
%
% Authors: Bongani Mbambiso, Tim Gebbie
%
% This test script is part of the "Sector and State" toolbox SECTOR.ZIP.
% The data set considered has correlated Assets with four clusters. The 
% test script is developed to show that the algorithm picks up 
% those clusters.
%
%
% References:
%
%  1. J. D. Noh, Phys. Rev. E 61, 5981 (2000)
%  1. L. Giada & M. Marsili (2005) ...
%  2. Marsili (2002) ... 
%
% See Also: ANNEALING, CHANGE, SWEEP, MERGE, SPLIT, GROUND, RECALCULATE 

% $Revision: 1.2 $ $Date: 2009/06/01 13:58:14 $ $Author: Tim Gebbie $

%% Clear the workspace
clear all; clc;

%% The algorithm used to control the entire algorithm
help annealing 

%% Rearrange the configuration several times for each cooling schedule 
help change 

%% Input Data and Variables 
% Initial beta
ib      = 1;     
% Final beta
fb      = 5;  
% Number of sweeps between changes in temperature
t_steps = 15;    % temperature changes every t_steps 
% Max. number of annealing cycles                   
n_cycles= 1; 
% Cooling Factor for delta_temperature
cf      = 0.997; 

%% Test 4.1: Correlated data with Four Clusters
C41 = [[ 1, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0.45]; ...
   [0.4,   1, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...
   [0.4, 0.4,   1, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...
   [0.4, 0.4, 0.4,   1, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...
   [0.4, 0.4, 0.4, 0.4,   1, 0.4, 0.4, 0.4, 0.4, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0.4, 0.4, 0.4, 0.4, 0.4,   1, 0.4, 0.4, 0.4, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...   
   [0.4, 0.4, 0.4, 0.4, 0.4, 0.4,   1, 0.4, 0.4, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...  
   [0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,   1, 0.4, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...   
   [0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,   1, 0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0,-.3,0,0,0,0,0,0,0,0]; ...
   [0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,   1,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  -.4,0,0,0,0,0,0,0,0,0]; ...
          
   [0,0,0,0,0,0,0,0,0,0,     1, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,  -0.1,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...  
   [0,0,0,0,0,0,0,0,0,0,   0.5,   1, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,  -0.2,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0.5, 0.5,   1, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,  -0.3,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...
   [0,0,0,0,0,0,0,0,0,0,   0.5, 0.5, 0.5,   1, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,  -0.4,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0.5, 0.5, 0.5, 0.5,   1, 0.5, 0.5, 0.5, 0.5, 0.5,  -0.6,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...  
   [0,0,0,0,0,0,0,0,0,0,   0.5, 0.5, 0.5, 0.5, 0.5,   1, 0.5, 0.5, 0.5, 0.5,  -0.5,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...
   [0,0,0,0,0,0,0,0,0,0,   0.5, 0.5, 0.5, 0.5, 0.5, 0.5,   1, 0.5, 0.5, 0.5,  -0.4,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ...
   [0,0,0,0,0,0,0,0,0,0,   0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,   1, 0.5, 0.5,  -0.3,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,   1, 0.5,  -0.2,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,   1,  -0.1,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0]; ... 
          
   [0,0,0,0,0,0,0,0,0,0,   -.1,-.2,-.3,-.4,-.6,-.5,-.4,-.3,-.2,-0.1,   1, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,  0,0,0,0,0,0,0,0,0,0]; ... 
       
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3,   1, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,  0,0,0,0,0,0,0,0,0,0]; ...  
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3, 0.3,   1, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3, 0.3, 0.3,   1, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3, 0.3, 0.3, 0.3,   1, 0.3, 0.3, 0.3, 0.3, 0.3,  0,0,0,0,0,0,0,0,0,0]; ...  
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3, 0.3, 0.3, 0.3, 0.3,   1, 0.3, 0.3, 0.3, 0.3,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3, 0.3, 0.3, 0.3, 0.3, 0.3,   1, 0.3, 0.3, 0.3,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,   1, 0.3, 0.3,  0,0,0,0,0,0,0,0,0,0]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,   1, 0.3,  0,0,0,0,0,0,0,0,0,0]; ...  
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,   1,  0,0,0,0,0,0,0,0,0,0]; ... 
          
   [0,0,0,0,0,0,0,0,0,-0.4,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,    1, 0.1, 0.1, 0.1,-0.1,-0.2, 0.1, 0.3, 0.4, 0.5]; ... 
   [0,0,0,0,0,0,0,0,-.3,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0.1,   1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.4]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0.1, 0.1,   1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.3]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0.1, 0.1, 0.1,   1, 0.1, 0.1, 0.1, 0.1, 0.1,-0.1]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0.1, 0.1, 0.1, 0.1,   1, 0.1, 0.1, 0.1, 0.1,-0.2]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, -0.2, 0.1, 0.1, 0.1, 0.1,   1, 0.1, 0.1, 0.1, 0.1]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, -0.1, 0.1, 0.1, 0.1, 0.1, 0.1,   1, 0.1, 0.1, 0.1]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0.3, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1,   1, 0.1, 0.1]; ... 
   [0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1,   1, 0.1]; ... 
   [0.45,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,  0.5, 0.4, 0.3,-0.1,-0.2, 0.1, 0.1, 0.1, 0.1,  1]];             

%% Generating Correlated Data 
data41 = mvnrnd(zeros(40,1),posdef(C41),100); 

%% Test 4.1.1: Use ANNEALING to generate clusters from the correlations    
[A] = annealing(C41,ib,fb,t_steps,n_cycles,cf);


%% Membership Matrix: Rows-Clusters, Columns-Objects
A.gs.I
